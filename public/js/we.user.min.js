WE.userPage={};
WE.userPage.editAccount={init:function(){this.ui={itemWall:$("#edit-info").find(".edit-item"),nickNameWall:$("#nickname-wall"),desWall:$("#des-wall"),nameClose:$("#close-name"),nameSubmit:$("#submit-name"),desClose:$("#close-des"),desSubmit:$("#submit-des"),nameInput:$("#name-input"),desInput:$("#des-input")};this.regEvent()},regEvent:function(){var b=this;this.ui.nickNameWall.find(".display").click(function(){b.viewName()});this.ui.desWall.find(".display").click(function(){b.viewDes()});this.ui.nameClose.click(function(){b.hideName()});
this.ui.desClose.click(function(){b.hideDes()});this.ui.nameSubmit.click(function(){var a=$.trim(b.ui.nameInput.val());""!=a&&b.updateUserName(a)});this.ui.nameInput.keyup(function(a){13==a.keyCode&&b.ui.nameSubmit.click()});this.ui.desSubmit.click(function(){var a=$.trim(b.ui.desInput.val());""!=a&&b.updateUseDes(a)});this.ui.desInput.keyup(function(a){13==a.keyCode&&b.ui.desSubmit.click()})},viewName:function(){this.ui.nickNameWall.addClass("edit-item-select");this.ui.nickNameWall.find(".edit").removeClass("hidden");
this.ui.nickNameWall.find(".icon-user").removeClass("color-user-dark").addClass("color-user-white")},viewDes:function(){this.ui.desWall.addClass("edit-item-select");this.ui.desWall.find(".edit").removeClass("hidden");this.ui.desWall.find(".icon-list").addClass("color-list-white")},hideName:function(){this.ui.nickNameWall.removeClass("edit-item-select");this.ui.nickNameWall.find(".edit").addClass("hidden");this.ui.nickNameWall.find(".icon-user").addClass("color-user-dark").removeClass("color-user-white")},
hideDes:function(){this.ui.desWall.removeClass("edit-item-select");this.ui.desWall.find(".edit").addClass("hidden");this.ui.desWall.find(".icon-list").removeClass("color-list-white")},updateUserName:function(b){var a=this,c=new WE.api.UserModel,d=new WE.Controller;d.update=function(c){0==c.data.code&&(a.ui.nickNameWall.find(".display .info").text(b).removeClass("no-info"),a.hideName())};c.addObserver(d);c.updateUserName(b)},updateUseDes:function(b){var a=this,c=new WE.api.UserModel,d=new WE.Controller;
d.update=function(c){0==c.data.code&&(a.ui.desWall.find(".display .info").text(b).removeClass("no-info"),a.hideDes())};c.addObserver(d);c.updateUserSummery(b)}};
WE.userPage.editAvatar={init:function(){this.ui={submit:$("#avatar-submit"),radios:$("#select-item")};this.regEvent()},regEvent:function(){var b=this;this.ui.submit.click(function(){var a=b.ui.radios.find("input[type=radio]:checked").val();b.updateAvatar(a)})},updateAvatar:function(b){var a=new WE.api.UserModel,c=new WE.Controller;c.update=function(b){location.reload()};a.addObserver(c);a.updateAvator(b)}};
WE.userPage.bindMail={init:function(){this.ui={submit:$("#bindMail-submit"),input:$("#bindMail-input"),tips:$("#bindMail-tip")};this.regEvent()},regEvent:function(){var b=this;this.ui.submit.click(function(){var a=$.trim(b.ui.input.val());""!=a&&(/^[^@]+@[^@]+$/.test(a)?b.verifMail(a,b.updateMail,b.errorTip):b.errorTip("Please enter a valid email"))});this.ui.input.keyup(function(a){13==a.keyCode&&b.ui.submit.click()});this.ui.input.focus(function(a){b.ui.tips.addClass("hidden")})},verifMail:function(b,
a,c){var d=new WE.api.UserModel,e=new WE.Controller;e.update=function(d){0==d.data.code?a&&a(b):c&&c("Email is exit! please try others")};d.addObserver(e);d.verifMail(b)},updateMail:function(b){var a=new WE.api.UserModel,c=new WE.Controller;c.update=function(b){console.log(b.data)};a.addObserver(c);a.updateMail(b)},errorTip:function(b){var a=this;this.ui.tips.text(b).removeClass("hidden");setTimeout(function(){a.ui.tips.addClass("hidden")},2E3)}};
WE.userPage.home={tmpl:'<li>\t\t\t\t<div class="avatar pull-left">\t\t\t\t\t<a href="/user/<%=_id %>">\t\t\t\t\t\t<img src="<%=avatar %>">\t\t\t\t\t</a>\t\t\t\t</div>\t\t\t\t<div class="info pull-left">\t\t\t\t\t<a href="/user/<%=_id %>"><%= name == "" ? "(\u672a\u8bbe\u7f6e\u6635\u79f0)" : name %></a>\t\t\t\t\t<span><%=summary == "" ? "(No description)" : WE.kit.cutOff(summary,30)  %></span>\t\t\t\t</div>\t\t\t</li>',noTmpl:"<li>\t\t\t\t<span>No contects...</span>\t\t\t</li>",init:function(){this.ui=
{list:$("#contacts")};this.loadContacts()},loadContacts:function(){var b=this,a=new WE.api.UserModel,c=new WE.Controller;c.update=function(a){a=a.data;0==a.code&&(0<a.result.length?b.appends(a.result):$(b.noTmpl).appendTo(b.ui.list))};a.addObserver(c);a.getContactList()},appends:function(b){var a="",c=0;if(0<b.length){for(var d=b.length;c<d;c++)a+=WE.kit.tmpl(this.tmpl,b[c].to);$(a).appendTo(this.ui.list)}}};
