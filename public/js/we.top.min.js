WE.api=WE.api||{};WE.api.TopModel=function(){this.historyChatsUrl="/sys/ichats"};WE.api.TopModel.prototype=WE.BaseModel.prototype;WE.api.TopModel.prototype.historyChats=function(){this.get(this.historyChatsUrl)};WE.pageTop={setUserName:function(b){var d=new WE.Dialog({title:"\u4fee\u6539\u6635\u79f0",id:"setUserName",width:400,height:200});d.show();WE.kit.getTmpl("update_user_name.ejs",function(e){e=WE.kit.tmpl(e,b);d.append(e);$("#setUserNameForm").submit(function(){var c=$("#newUserName"),a=c.val();if(a){var c=new WE.api.ChatModel,b=new WE.Controller;b.update=function(a){a.data.code==0&&(d.close(),setTimeout(function(){document.location.reload()},500))};c.addObserver(b);c.updateUserName(a)}else c.focus();
return!1});$("#anonymous").click(function(){$("#newUserName").val("\u533f\u540d");$("#setUserNameForm").submit()})})},bindEmail:function(){function b(b,c){var a=new WE.api.ChatModel,f=new WE.Controller;f.update=function(a){a.data.code==0&&(d.close(),document.location.reload())};a.addObserver(f);a.updateMailPwd(b,c)}var d=new WE.Dialog({title:"\u8bbe\u7f6email",id:"setMail",width:400,height:200});d.show();WE.kit.getTmpl("bind_mail.ejs",function(e){d.append(e);$("#bindMialForm").submit(function(){var c=
$.trim($("#updateMail").val()),a=$.trim($("#updatePwd").val());/^[\w._\-]+@[\w_\-]+\.\w+$/.test(c)?a.length>5?b(c,a):alert("\u5bc6\u7801\u957f\u5ea6\u81f3\u5c116\u4f4d"):alert("mail, \u683c\u5f0f\u4e0d\u6b63\u786e");return!1})})},getHistory:function(){var b=new WE.Dialog({title:"\u53c2\u4e0e\u8fc7\u7684\u5bf9\u8bdd",id:"getHistory",width:200,height:200});b.show();WE.kit.getTmpl("history_chat.ejs",function(d){var e=new WE.api.TopModel,c=new WE.Controller;c.update=function(a){a=a.data;a.code==0&&(a=
WE.kit.tmpl(d,a.result),b.append(a))};e.addObserver(c);e.historyChats()})}};WE.pageTop.init=function(){var b=this;$("#username").click(function(){b.setUserName(USER)});$("#bindmail").click(function(){b.bindEmail()});$("#chatme").click(function(){b.getHistory()})};$(document).ready(function(){WE.pageTop.init()});
