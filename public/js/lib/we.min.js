/*! vchat.co 2014-01-01 03:06:28 */
var WE={extend:$.extend,ui:{},kit:{},cookie:{},api:{},page:{},markdown:{},Observer:{notice:function(){Array.prototype.unshift.call(arguments,{target:this,data:arguments[0]});for(var a=0;this.observers&&a<this.observers.length;a++)try{this.observers[a].update.apply(this.observers[a],arguments)}catch(b){window.console&&console.log(b)}},addObserver:function(a){a&&a.update?(this.observers||(this.observers=[]),this.observers.push(a)):console.error("observer.update not fucntion ")},removeObserver:function(a){for(var b=0;this.observers&&b<this.observers.length;b++)a===this.observers[b]&&(this.observers.splice(b,1),b--)}}};WE.Controller=function(a){this.msg={"-99":"服务器错误"},a&&WE.extend(this,a)},WE.Controller.prototype={constructor:WE.Controller,update:function(a){0==a.code||WE.ui.alert(this.getCodeMsg(a.code))},error:function(a){window.console&&console.log("xhr 错误",a.status)},getCodeMsg:function(a){this.msg&&(b=this.msg[a]);var b=this.msg?this.msg[a]:null;return b?b:"错误代码:"+a}},WE.BaseModel=function(a){this.init(a)},WE.BaseModel.prototype={constructor:WE.BaseModel,init:function(a){a&&WE.extend(this,a)},error:function(a,b){for(var c=this.observers,d=0;c&&d<c.length;d++)c[d].error&&c[d].error(a,b)},post:function(a,b){var c=this;$.ajax({url:a,type:"post",data:b,dataType:"json",error:function(a,b){c.error(a,b)},success:function(a){c.notice(a)}})},get:function(a,b){var c=this;$.ajax({url:a,type:"get",data:b,dataType:"json",error:function(a,b){c.error(a,b)},success:function(a){c.notice(a)}})}},WE.extend(WE.BaseModel.prototype,WE.Observer),WE.extend(WE.cookie,{getCookie:function(a){for(var b=document.cookie.split(";"),c=0,d=b.length,e=null,f=null;d>c;c++)if(e=b[c].split("="),a==e[0].replace(/(^\s*)|(\s*$)/g,"")){f=e[1];break}return f},setCookie:function(a,b){var c=a+"="+escape(b);document.cookie=c}}),WE.extend(WE.kit,{cache:{},tmpl:function(a,b){var c=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):cache[a]=cache[a]||tmpl(document.getElementById(a).innerHTML);return b?c(b):c},pad:function(a,b,c){var d=b-String(a).length;if(0>d)return a;var e=new Array(b-String(a).length||0);return e.push(a),e.join(c||"0")},format:function(a,b){a=new Date(a);var c=this.pad,d={yy:String(a.getFullYear()).slice(-2),yyyy:a.getFullYear(),M:a.getMonth()+1,MM:c(a.getMonth()+1,2,"0"),d:a.getDate(),dd:c(a.getDate(),2,"0"),h:a.getHours(),hh:c(a.getHours(),2,"0"),m:a.getMinutes(),mm:c(a.getMinutes(),2,"0"),s:a.getSeconds(),ss:c(a.getSeconds(),2,"0")};return(b||"yyyy-MM-dd hh:mm:ss").replace(/yyyy|yy|MM|M|dd|d|hh|h|mm|m|ss|s/g,function(a){return d[a]})},weFormat:function(a){var b="",c=new Date(a),d=new Date,e=d.getFullYear(),f=d.getMonth()+1,g=d.getDate(),h=c.getFullYear(),i=c.getMonth()+1,j=c.getDate(),k=[h,i,j],l=[c.getHours(),c.getMinutes(),c.getSeconds()];return h==e?i==f?b=j==g?"Today "+l.join(":"):j-g==1?"Yesterday "+l.join(":"):k.splice(1,3).join("-")+" "+l.join(":"):i!=f&&(b=k.splice(1,3).join("-")+" "+l.join(":")):b=k.join("-")+" "+l.join(":"),b},sortFormat:function(a){return this.format(a,"yyyy-MM-dd")},longFormat:function(a){return this.format(a,"yyyy-MM-dd hh:mm:ss")},getTmpl:function(a,b){var c=this;return c.cache[a]?(b&&b(c.cache[a]),void 0):($.ajax({url:"/api/tmpl",medthod:"get",data:{path:a},success:function(d){c.cache[a]=d,b&&b(d)}}),void 0)},cutOff:function(a,b){return a.length>b?a.slice(0,b)+"...":a},getRadioValue:function(a){return $("input[type=radio][name="+a+"]:checked").val()},weTime:function(){var a=[{t:6e4,s:"刚刚"},{t:12e4,s:"1分钟"},{t:18e4,s:"2分钟"},{t:36e4,s:"5分钟"},{t:66e4,s:"10分钟"},{t:18e5,s:"30分钟"},{t:36e5,s:"1小时"},{t:72e5,s:"2小时"},{t:18e6,s:"5小时"},{t:864e5,s:"1天前"},{t:1728e5,s:"2天前"}];return function(b){for(var c=(new Date).getTime(),d=c-b,e=0;e<a.length;)if(a[e++].t>d)return a[e-1].s;return WE.kit.format(b,"MM-dd hh:mm:ss")}}(),getAvatar:function(a,b,c){return a=a||"00000000000000000000000000000000",b=b||48,c=c||"mm","http://www.gravatar.com/avatar/"+a+"?s="+b+"&d="+c},chatFormate:function(a){return a.replace(/\n/gi,"<br/>").replace(/http:\/\/[\w\.\/\:\?\&\=\#\-\_]+/gi,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"})},removeHtmlTag:function(a){return a.replace(/<|>/g,function(a){return"<"==a?"&lt;":"&gt;"})},revertHtmlTag:function(a){return a.replace(/\n/gi,"<br/>").replace(/http:\/\/[\w\.\/\:\?\&\=\#\-\_]+/gi,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"})},getHidden:function(){var a;return"undefined"!=typeof document.hidden?a="hidden":"undefined"!=typeof document.mozHidden?a="mozHidden":"undefined"!=typeof document.msHidden?a="msHidden":"undefined"!=typeof document.webkitHidden&&(a="webkitHidden"),document[a]},titleRoll:function(a,b){var c=a.split(""),d=function(){c.push(c[0]),c.shift(),document.title=c.join("")};setInterval(d,b)}}),WE.extend(WE.markdown,{defaultPrefix:"```",format:function(a){if(String(a).length>0){for(var b=a.split(this.defaultPrefix),c=-1,d=0;d<b.length;d++)-1==c?(c=d,b[d]=WE.kit.removeHtmlTag(b[d]),b[d]=this.lineFormat(b[d]),b[d]=this.urlFormat(b[d])):(b[c+1]="<pre>"+b[c+1],b[d]+="</pre>",c=-1);return b.join("")}return a},urlFormat:function(a){return a.replace(/(http|https):\/\/[\w\.\/\:\?\&\=\#\-\_]+/gi,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"})},lineFormat:function(a){return a.replace(/\n/gi,"<br/>")}}),WE.extend(WE.ui,{ok:function(a,b){b=b||3e3;var c=this.tip({context:a,okbtn:!1,cancelbtn:!1,type:"success",timeout:b,title:"提示"});return c.ui.close.focus(),c},alert:function(a,b){this.alert.tip&&(this.alert.tip.option.callback=null,this.alert.tip.close());var c=this.tip({context:a,cancelbtn:!1,type:"notice",callback:b,title:"提示"});return c.ui.ok.focus(),this.alert.tip=c,c},confirm:function(a,b){if(this.confirm.tip)return this.confirm.tip;var c=this,d=this.tip({context:a,closebtn:!1,type:"notice",callback:function(a){c.confirm.tip=null,a="ok"==a?!0:!1,b&&b(a)},title:"提示"});return this.confirm.tip=d,d.ui.ok.focus(),d},tip:function(){function a(a){this.option={title:"提示",context:"hello world",callback:function(){},timeout:0,okbtn:!0,cancelbtn:!0,closebtn:!0,type:"notice"},$.extend(this.option,a),this.init()}var b={title:"提示",close:"关闭",ok:"确定",cancel:"取消"},c='<div class="moxian-ui-tip">				<div class="ui-tip-wrapper">					<div class="ui-tip-main">						<div class="ui-tip-title">							<h1><%=title%></h1>							<%if(closebtn){%>							<input type="button" class="ui-btn-close pngbg" title="'+b.close+'" />							<%}%>						</div>						<div class="ui-tip-context">							<%if(type){%>							<p class="p">								<span class="ui-tip-icon ui-tip-<%=type%>"></span><span><%=context%></span>							</p>							<%}else{%>								<%=context%>							<%}%>						</div>						<div class="ui-tip-btn">							<%if(okbtn){%>								<input type="button" title="'+b.ok+'" class="btn-primary js_ok" value="'+b.ok+'" />							<%}%>							<%if(cancelbtn){%>								<input type="button" title="'+b.cancel+'" class="btn marl10 js_cancel" value="'+b.cancel+'" />							<%}%>						</div>					</div>				</div>				<div class="ui-tip-bg">背景</div>			</div>';return a.prototype={init:function(){var a=WE.kit.tmpl(c,this.option),b=$("<div></div>").append(a);this.ui={wrapper:b.find(".moxian-ui-tip"),title:b.find(".ui-tip-title"),close:b.find(".ui-btn-close"),ok:b.find(".js_ok"),cancel:b.find(".js_cancel")},$(document.body).append(b.find(".moxian-ui-tip")),this.regEvent(),this.option.timeout&&this.setTimeout(this.option.timeout),new WE.kit.DragElement({dragElement:this.ui.title,moveElement:this.ui.wrapper,isRange:!1,isResize:!1,offsetTop:0}).init(),this.updatePos()},regEvent:function(){function a(c){27==c.keyCode&&(b.close("close"),$(window).unbind("keyup",a))}var b=this;this.ui.close.click(function(){b.close("close")}),this.ui.ok.click(function(){b.close("ok")}),this.ui.cancel.click(function(){b.close("cancel")}),$(document).keyup(a)},close:function(a){this.ui.wrapper.remove(),this.option.callback&&this.option.callback(a)},updatePos:function(){var a=$(window).height(),b=$(window).width();this.setPos((a-this.ui.wrapper.height())/2,(b-this.ui.wrapper.width())/2)},setTimeout:function(a){var b=this;setTimeout(function(){b.close("auto")},a)},setPos:function(a,b){this.ui.wrapper.css({top:a+"px",left:b+"px"})}},function(b){return new a(b)}}()});